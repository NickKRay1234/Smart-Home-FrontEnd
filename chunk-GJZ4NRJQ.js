import{a as C,q as u,r as d,s as I}from"./chunk-MTZZGECX.js";import{J as b,K as y,La as s,N as a,T as i,Y as v,ba as S,c as h,ka as c,n as l,v as f}from"./chunk-DXEYFIYH.js";function m(o){o||(S(m),o=i(c));let t=new h(e=>o.onDestroy(e.next.bind(e)));return e=>e.pipe(b(t))}var q=class o{transform(t){if(t||t===0){let e=t.toString().split(""),r="";for(let n=e.length;n>0;n-=3)r+=e.splice(-3).join("")+" ";return r.split(" ").reverse().join(" ")}return""}static \u0275fac=function(e){return new(e||o)};static \u0275pipe=v({name:"price",type:o,pure:!0,standalone:!0})};var w=class o{apiUrl=u.apiUrl;httpClient=i(C);errorHandler=i(I);destroyRef=i(c);alertService=i(d);getCart(){return this.httpClient.get(`${this.apiUrl}ShoppingCart?id=as12`).pipe(l(t=>t.data),f(this.errorHandler.handleError("Cart error")))}addToCart(t){return this.httpClient.post(`${this.apiUrl}ShoppingCart`,t).pipe(l(e=>e.data),f(this.errorHandler.handleError("Wasn't added to cart")))}deleteCart(t){this.httpClient.delete(`${this.apiUrl}ShoppingCart?id=${t}`).pipe(m(this.destroyRef),y(e=>console.log(e))).subscribe()}static \u0275fac=function(e){return new(e||o)};static \u0275prov=a({token:o,factory:o.\u0275fac})};var Y=o=>({items:o,clientSecret:u.clientId,id:"as12",paymentIntentId:"",deliveryMethodId:0});var p=class o{products=s([]);setProductStorage(t){this.products.set(t)}getProductsStorage(){return this.products()}findProductStorageById(t){return this.products().find(e=>e.productId===t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var j=class o{cartStorage=s([]);total=s(0);productStorage=i(p);alertService=i(d);getCartStorage(){return this.cartStorage()}setCartStorage(t){this.cartStorage.set(t)}updateCartStorage(t){this.cartStorage.update(e=>{let r=!1;return e.forEach(n=>{n.productId===t.productId&&(n.quantity+=1,n.price=t.productPrice*n.quantity,r=!0)}),r?[...e]:[...e,{productId:t.productId,productName:t.productName,price:t.productPrice,quantity:1,pictureUrl:t.images[0].imageUrl,productPrice:t.productPrice}]})}decreaseCartStorage(t){this.cartStorage.update(e=>(e.forEach(r=>{if(r.productId===t&&r.quantity>1){let n=r.price/r.quantity;r.quantity-=1,r.price=r.quantity*n}}),this.countTotal(this.cartStorage()),[...e]))}increaseCartStorage(t){let e=this.productStorage.getProductsStorage().find(r=>r.productId===t)?.quantityInStock;this.cartStorage.update(r=>(r.forEach(n=>{if(e&&e<=n.quantity&&this.alertService.setAlert({message:"\u0414\u043E\u0441\u044F\u0433\u043D\u0443\u0442\u043E \u043C\u0430\u043A\u0441\u0438\u043C\u0430\u043B\u044C\u043D\u043E\u0457 \u043A\u0456\u043B\u044C\u043A\u043E\u0441\u0442\u0456",status:"warn"}),e&&e>n.quantity&&n.productId===t){let P=n.price/n.quantity;n.quantity+=1,n.price=n.quantity*P}}),this.countTotal(this.cartStorage()),[...r]))}deleteItemCartStorage(t){this.cartStorage.update(e=>e.filter(r=>r.productId!==t)),this.countTotal(this.cartStorage())}countTotal(t){let e=t.reduce((r,n)=>r+n.price,0);this.total.set(e)}getTotal(){return this.total()}static \u0275fac=function(e){return new(e||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a,q as b,w as c,Y as d,p as e,j as f};
